#!/usr/bin/python

import os
import socket
import sys

def retbanner(ip,port):
	try:
		socket.setdefaulttimeout(2)
#		set default timeout to 2
		s = socket.socket()
#		creates a 'socket'
		s.connect((ip,port))
#		connect to ip:port
		banner = s.recv(1024)
#		recieve banner of 1024 bytes
		return banner
	except:
		return

def checkVulns(banner, filename):
    with open(filename, "r") as f:
#     opening file. within brackets specify filename, this case its a variable. reading file and comparing against banner
#    three ways to open file, read, write, append
        for line in f.readlines():
#     function to read each line by itself
            if line.strip("/n") in banner:
#        'strip' each character in the line. if the line is in txt file
                print '[+] Server is Vuln' + banner.strip("/n")
#            printing a string plus the banner that is vuln






def main():
	if len(sys.argv) == 2:
		filename = sys.argv[1]
		if not os.path.isfile(filename):
			print ("[-] File Doesnt Exist")
			exit(0)
		if not os.access(filename, os.R_OK):
			print '[-] Acess Denied'
			exit(0)
	else:
		print ('[-] Usage: ' + str(sys.argv[0]) + " <vuln filename>")
		exit(0)
	portlist = [21,22,25,80,110,443,445]
	for x in range(1,255):
		ip = "192.168.223." + str(x)
		for port in portlist:
			banner = retbanner(ip,port)
			if banner:
				print '[+] ' + ip + "/" + str(port) + " : " + banner
				checkVulns(banner, filename)




main()
